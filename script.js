document.addEventListener('DOMContentLoaded', () => {
    const envelope = document.getElementById('envelope');
    const openButton = document.getElementById('openButton');
    const letterContainer = document.getElementById('letterContainer');
    const letterContent = document.getElementById('letterContent');
    const prevPage = document.getElementById('prevPage');
    const nextPage = document.getElementById('nextPage');

    // 示例信件内容，分为多页
    const pages = [
        "今年忙得不可开交，尤其是期末，一时竟忘了给你写日志。直到1月1日才想起来要补上。如果腾讯如我所料没坚持到你看信的那一天，那么空间日志里从2018年开始的那六封信你都见不到了。这应该是你读到的第一封。我写这封信时，坐在北京市海淀区后厂村路的航天人才房内。还记得我来这里是为了什么吗？是不是有点佩服我了？对了，用你的名字申请了个域名，还瞎捣鼓了个网页，虽然设计得不咋地，但起码能坚持个六七十年，到你看到这封信时应该还在。本来今早想起没写日志的时候还想偷个懒，但想到你现在可能步履蹒跚、耳背眼花、孤零零地喝着茶，我觉得还是得写点什么。快泡好茶，戴上老花镜，听我唠一唠吧。",
        "按老规矩，先聊聊学业。也没几年可谈了，再跟你谈两三回，估计就毕业了。如果你是从空间日志里去年那封信接着看的话，你一定能理解今年年初我的纠结。但最后，在今年3月，我还是和杨女士、李老师挥手作别，南下深圳。原因很简单：实验室搞的是人工智能的前沿方向，这不仅是我的兴趣所在，更是未来的通行证。而次要原因嘛，实在是这里的条件太好了，国内妥妥的天花板，比西欧读博的待遇还优厚。虽然你可能现在看这封信时不屑一顾，但对当时的我来说，简直天降福音。当然，我得强调一下，主要还是因为第一点，我喜欢这个方向。别看我年纪小，我可不肤浅，你得为我骄傲！",
        "去年信里的徐老师跑去新加坡国立了，临走前给我推了翼老师。所以上半年，我基本跟着翼老师混日子。真的太快乐了，快乐到堕落。他不怎么管人，我每天九点晃到实验室，中午回来睡个午觉，甚至有时直接不去。因为这种摆烂的节奏，我和杨女士的异地恋也在起初阶段还能两周见一次，但后来次数渐渐减少。到5月1日后，我猛然意识到这种状态不能再继续，于是开始疯狂读论文、跑代码，用两个月的努力换来了7月一份满分答卷！",
        "答得太好，引来吴老师的青睐，从此命运迎来了巨变。7月和杨女士分手，事后回想我确实有点绝情，也误会了她。但已经这样了，我没有回头挽留的打算。最主要的原因是什么呢？上个月她打电话来，说喝醉了，想复合。当时我正在百度产业园出差，她的话让我冷静下来反思了一阵：我发现自己已经习惯了一个人的状态。她提出复合时，我竟毫无欣喜之情。这让我意识到，情感是当下的选择，而非沉溺于过去的感性冲动。",
        "其实她打来电话我有点动摇了，想起了她的各种好。如果我还是上半年在翼老师那边，我一定是跟她也讲讲我当时做错的地方然后跟她复合。只不过，没有如果，我一想到我现在的学习压力以及即将到来的期末，我觉得我无法再向上学期一样千里迢迢跟她相见，因为上半年我经历了这样的苦，所以之前所谓所爱隔山海，山海皆可平的口号我不再挂在嘴边，真正经历后我被打败了。我不希望她需要我陪她的时候我不能第一时间出现在她身边这类事情再次发生，我觉得应该即时止损，为我也为她。",
        "第二次通话时，我坦诚告诉她我的想法。她听后说自己没有想太远，只是想在当下和我聊聊天。那天我们聊了两个多小时，结束后我一个人跑去我们曾去过的德国餐厅，吃饭间我终于下定决心，不能再耗下去了。我知道自己很自私甚至冷血，但我无法放弃自己的理想，也无法辜负吴老师的栽培。于是，我第一次拉黑了一个人。这不是孩子气的赌气，而是为了避免每次看到她时，那种难以承受的情绪波动。",
        "我以为自己足够强大，但每次看到她发朋友圈，内心依旧被无尽的遗憾笼罩。我希望自己能云淡风轻地面对，但显然做不到。于是，我选择彻底断开所有联系。回想起我们在一起的那些日子，我感到无比幸福，但我更知道，我们的未来无法继续。也许你现在会感慨万千，但请记住，这只是我当时认知下的最优解，毫无遗憾。",
        "不知道你心里怎么想，但有一点，不要有任何后悔的情绪。我不希望你带着遗憾去读我每年给你写的信，我只是在向你讲述来时的路，以及旅途中遇到的人和风景。没必要回头遗憾，相信我，你的旅途足够精彩。所有的选择都是基于我当前认知的最优解，没什么可后悔的。不知道她现在怎么样，跟她的这一路真的很快乐，这几百多天我的生活里只有学业父母和她，想起来我们这么久好像只吵了几次架，次次到凌晨，当天的问题当天解决，真的好可爱我们俩。唯一的遗憾就是没有陪她重游硕士校园，她可是跟我提了无数回啊，她一定很想让我陪她再去一次。希望她一切安好，她这么优秀漂亮的姑娘一定会幸福的。",
        "分手后的第二天，我飞去了重庆出差。站在嘉陵江边，回忆如电影般在脑海中闪过，(如果QQ没倒闭，之前的信里你应该也能复习到，真离谱)。但我知道，所有的故事终将翻篇。科研的路还长，得继续努力了。",
        "新的课题组很好，吴老师对我也很好，课题组的四个北航，一个华工，一个中大的小伙伴们也特别好，氛围超级舒服！从7月到现在，我去了14座城市，项目任务多得不可思议。年末时事情更是蜂拥而至，忙到高铁飞机上全看论文。年内最难忘的一次，就是为那什么长奖章去答辩，前面的选手是清华本硕博连读的大佬，一年成果顶我博士毕业两次，人比人，真能气死人。",
        "12月终于解决了困扰我一年的方向问题，西安的老师放手了。我和吴老师去西安出差，当面和李老师谈了三小时，算是给这段纠葛画上了句号。现在，我可以全心全意投入深圳的学业和项目了。轻装上阵，这感觉真好！",
        ""
    ];

    let currentPage = 0;

    // 打开信封动画
    openButton.addEventListener('click', () => {
        envelope.style.transform = 'rotateY( -180deg )';
        setTimeout(() => {
            envelope.classList.add('hidden');
            letterContainer.classList.remove('hidden');
            displayPage(currentPage);
        }, 1000); // 动画时间同步
    });

    // 显示当前页内容，逐字显示
    function displayPage(pageIndex) {
        letterContent.innerHTML = '';
        const text = pages[pageIndex];
        let index = 0;

        function typeChar() {
            if (index < text.length) {
                const char = text.charAt(index);
                if (char === '\n') {
                    letterContent.innerHTML += '<br>';
                } else {
                    letterContent.innerHTML += char;
                }
                index++;
                setTimeout(typeChar, 50); // 每个字出现的间隔时间
            }
        }

        typeChar();
    }

    // 翻到上一页
    prevPage.addEventListener('click', () => {
        if (currentPage > 0) {
            currentPage--;
            displayPage(currentPage);
        }
    });

    // 翻到下一页
    nextPage.addEventListener('click', () => {
        if (currentPage < pages.length -1) {
            currentPage++;
            displayPage(currentPage);
        }
    });
});
